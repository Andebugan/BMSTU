# Базы данных | Лекция 7 | 23.10.2021
## Ремарка по поводу рубежного контроля
Переписать рубежный контроль можно на любом семинаре не у своей группы. Переписываем на минимум, если хочется повысить балл, то механика та же, что и при переписывании. 

Рк №3 состоит из трёх заданий и проходит на 11 неделе. Можно повысить баллы, если с первого раза больше чем на минимум. На рк будет нужен ноутбук. На 2 рк можно пользоваться всем чем угодно, кроме лекций.

Структура:\
1:
- Дана схема базы данных, похожая на схему из первого рк, необходимо создать схему с ключами и прочими ограничениями + необходимо указывать развязочные таблицы, если создаются.
- Необходимо наполнить базу данных данными.

2:
- Дано задание на написание запроса (select), необходимо написать запрос и комментарий к нему, балл за то, что результат запроса совпадает с комментарием, иначе нет баллов. 

3:
- Написание функций, которые так или иначе общаюся с метаданными базы данных.

## Проектирование баз данных
При проектировании решаем две задачи - логическую и физическую.
Логическая задача - преобразование каких-либо объектов реального мира в абстрактном формате базы данных. Необходимо, чтобы созданное представление полностью покрывало реальные объекты.

Физическая задача - обеспечение запросов к базе данных, DML-язык и его активизация.

Две категории систем:
- OLTP - online transaction processing - базы данных, нацеленные на транзакции, нацеленные на накопления. - select
- OLAP - online analitics processing - аналитическая работа с базами данных. - insert, update, delete

## Нормальные формы (NF)
1. 1NF
2. 2NF
3. 3NF
4. 3NFvSI (BCNF)
5. 4NF
6. 5NF

Аксиома - каждая следующая нормальная форма "лучше" предыдущей, т.е. каждая следующая форма является более устойчивой к аномалиям, чем предыдущая. В следствие декомпозиции, чем более устойчивая - тем меньше скорость работы.

Аномалия вставки - нельзя вставить элемент без создания другой сущности.

Аномалия удаления - без удаления информации в одной сущности нельзя удалить информацию о другой.

Аномалия обновления - без обновления одних данных нельзя обновлять другие.

Чем выше уровень нормализации, тем меньше уровень дублированности данных. 

## Декомпозиция

Пусть у нас есть отношение R (A, B, C), декомпозиция отношения R называется такая замена множества R на R = {R1, R2, R3}, где каждое из подмножеств есть проекция R. Ограничение - хотя бы один атрибут отношения R входит в хотя бы одну проекцию.

{a}, {b}, {c}\
{a, b}, {a}, {c}\
{a, b}, {a, c}, {a, b, c}

Декомпозиция без потерь - такие проекции отношения R, которые при использовании join дают начальное отношение R.

|a|b|c|
|-|-|-|
|Москва|РФ|столица|
|Омск|РФ|не столица|
|Берлин|Германия|столица|

Без потерь - {a, b}, {a, c}

## 1NF

В первой нормальной форме - все атрибуты простые, а все домены содержат только скаляры.

|id|Phone|
|-|-|
|1|8-912-324-12-32|
|2|8-915-314-43-12|

Атрибуы должны быть атомарными - не массивы

## 2NF

Находится в 1NF, каждый неключевой атрибут неприводимо зависит от ключевого атрибута. То есть в составе ключа отсутствует меньшее подмножество атрибутов, от которого можно вывести эту функциональную зависимость.

|Модель|Фирма|Цена|Скидка|
|-|-|-|-|
|М5|BMW|5.5|5%|
|X5M|BMW|6|5%|
|M1|BMW|7.5|5%|
|GT-R|Mustang|13|10%|

{Модель, Фирма} -> {Цена}\
{Фирма} -> {Скидка} - нарушается условие

Разносим:\
R1 - Модель, Фирма, Цена\
R2 - Фирма, Скидка

## 3NF

Отношение находится в третьей нормальной форме, когда оно находится в 2NF и каждый неключевой атрибут нетранзитивно зависит от первичного ключа.

|Модель|Магазин|Телефон|
|-|-|-|
|BMW|магазин 1|00-01|
|Audi|магазин 1|00-01|
|Nissan|магазин 2|00-02|

{Модель} -> {Магазин}\
{Модель} -> {Телефон}\
{Магазин} -> {Телефон} - нарушение третьей нормальной формы

R1 - {Магазин, модель}
R2 - {Магазин, телефон}

## BCNF

Отношение находится в нормальной форме Бойса-Кодда, когда каждая нетривиальная и неприводимая слева функциональная зависимость обладает ключом в качестве дискриминанта.

|Номер стоянки|Время бронирования|Время конца обслуживания|Тариф|
|-|-|-|-|
|1|9:30|10:30|T1|
|2|11:00|12:00|T1|
|1|14:00|15:30|T2|
|2|10:00|12:00|T3|
|2|12:00|14:00|T3|
|2|15:00|18:00|T4|

Первичные ключи:\
{Номер стоянки, время начала}\
{Номер стоянки, воемя окончания}\
{Тариф, время окончания}\
{Тариф, время начала}

# 4NF
Отношение находится в 4NF, если оно находится в BCNF и все нетривиальные многозначные функциональные зависимости являются фнукциональными зависимостями от её потенциальных ключей.

|Ресторан|Вид пиццы|Район доставки|
|-|-|-|
|R1|Тл К|R1|
|R1|Тл К|R2|
|R1|Тл К|R3|
|R1|Ф К|R1|
|R1|Ф К|R2|
|R1|Ф К|R3|
|R2|Тл К|R3|
|R2|Ф К|R3|
